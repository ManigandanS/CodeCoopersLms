angular.module("vt").controller("appController",["$rootScope","$scope","$location","authenticationSvc",function(e,n,t,o){function s(){n.isSignedIn=o.isSignedIn(),n.isSignedIn&&(e.user||(e.user=o.getUserInfo()),n.user=e.user)}s(),n.signout=function(){o.signout(),e.$broadcast("signoutSuccess")},e.$on("signoutSuccess",function(){n.user=null,s()}),e.$on("signinSuccess",function(){s()}),n.traineeAccount=function(){n.user&&t.path("/trainee/"+n.user.Id)}}]),angular.module("vt.account").controller("signupController",["$rootScope","$scope","$location","authenticationSvc","classService",function(e,n,t,o,s){function i(){n.user={Name:"",Email:"",Phone:"",Password:""},n.signupOk=!1,n.errorMessage=""}n.signup=function(){o.signup(n.user).then(function(c){c.IsSuccess?(e.user=o.getUserInfo(),e.$broadcast("signinSuccess"),s.unlockFirstContent().then(function(){i(),t.path("/course-detail")}),alert("Thanks for signing up "+n.user.Name+". Please check your email for detail instruction. ")):n.errorMessage=c.Message})},i()}]),angular.module("vt.account").controller("signinController",["$rootScope","$scope","$location","authenticationSvc",function(e,n,t,o){function s(){n.user={Email:"",Password:""},n.signinOk=!1,n.errorMessage=""}n.signin=function(){o.signin(n.user).then(function(i){i.IsSuccess?(alert(i.Message),s(),e.user=o.getUserInfo(),e.$broadcast("signinSuccess"),t.path("/course-detail")):n.errorMessage=i.Message},function(e){console.log(e),alert(e.Message)})},s()}]),angular.module("vt.course").controller("courseDetailController",["$rootScope","$scope","$location","courseDetailService",function(e,n,t,o){function s(){o.get().then(function(e){console.log(e),n.levels=e.Data})}n.levels=[],s(),n.gotoDetails=function(n,o){e.level=o,t.path("/class-detail/"+n.Id)}}]),angular.module("vt.course").controller("classController",["$rootScope","$scope","$routeParams","$location","classService",function(e,n,t,o,s){function i(){var e=t.id;s.isUnlocked(e).then(function(t){t.IsSuccess?s.get(e).then(function(e){console.log(e),e.IsSuccess&&(n.content=e.Data,2===n.content.Type?n.loadQuiz():n.content.VideoUrl&&setTimeout(function(){wistiaEmbed=Wistia.embed(n.content.VideoUrl,{videoFoam:!0})},500))}):(alert("The requested content is not unlocked yet."),o.path("/"))},function(e){console.log(e),alert(e.Message),o.path("/")})}n.content={Type:0},n.showVideo=!0,i(),n.gotoNext=function(){n.content.Level.Count==n.content.No?alert("End of the level "+n.content.Level.Name):s.getId({contentNo:n.content.No+1,levelNo:n.content.Level.No}).then(function(e){s.isUnlocked(e.Data).then(function(t){t.IsSuccess?o.path("/class-detail/"+e.Data):(alert("Your requested content is locked. It is a paid content and is accessible only if you completed your current quiz. In case you completed the quiz, please retake it."),n.loadQuiz(),n.showVideo=!1)})},function(e){console.log(e)})},n.gotoPrevious=function(){1==n.content.No?alert("no previous"):s.getId({contentNo:n.content.No-1,levelNo:n.content.Level.No}).then(function(e){console.log(e.Data),o.path("/class-detail/"+e.Data)},function(e){console.log(e)})},n.loadQuiz=function(){s.loadQuiz(n.content.Id).then(function(e){n.quiz=e.Data},function(e){alert("Error occurred."+e.Data)})};var c=function(){for(var e,t,o=[],s=0;s<n.quiz.Questions.length;s++){if(e=null,1===n.quiz.Questions[s].Type){for(t=0;t<n.quiz.Questions[s].Options.length;t++)if(n.quiz.Questions[s].Options[t].Id===n.quiz.Questions[s].IsSelected){e={QuestionId:n.quiz.Questions[s].Id,AnswerText:n.quiz.Questions[s].Options[t].Name};break}}else e={QuestionId:n.quiz.Questions[s].Id,AnswerText:n.quiz.Questions[s].IsSelected};o.push(e)}return{ContentId:n.quiz.ContentId,QuizHistoryId:n.quiz.Id,Answers:o}};n.submitQuizAnswers=function(){var e=c();console.log(e),s.submitAnswers(e).then(function(e){e.IsSuccess?o.path("/class-detail/"+e.Data.ContentId):(alert(e.Message),"Assignment"===e.Data&&o.path("/"))})},n.gotoDetails=function(e){o.path("/class-detail/"+e.Id)}}]),angular.module("vt.account").controller("traineeController",["$rootScope","$scope","$location","$routeParams","authenticationSvc","traineeService",function(e,n,t,o,s,i){function c(){n.trainee={Name:"",Email:"",Phone:"",Password:""},n.payment={},i.get(o.id).then(function(e){n.trainee=e.Data},function(e){alert(e.Message),t.path("/#/course-detail")})}o.id?c():t.path("/#/course-detail"),n.pay=function(){n.payment.TraineeId=n.trainee.Id,i.pay(n.payment).then(function(){c()},function(e){alert(e.Message)})}}]);